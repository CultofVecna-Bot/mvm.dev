### API

`POST https://api.mvm.dev/payments`

### Introduction
  Faced with the risk of exposing keystore, one can access
  [POST /payments api](https://developers.mixin.one/docs/api/transfer/payment) with signature,
  
  To avoid it，developers could get `code_id` using this api with the same arguments. 
  In addition, this api would automatically write `extra` and its hash to Storage Contract freely,
  with restriction of 32 times accesses in 24h per ip.

### Parameters

| Parameter         |  Type  | Required | Explain                                                 |
|:------------------|:------:|:--------:|:--------------------------------------------------------|
| asset_id          | string |   true   | asset id in Mixin                                       |
| amount            | string |   true   | transfer amount                                         |
| trace_id          | string |   true   | unique transfer id                                      |
| memo              | string |   true   | transfer memo, generated by extra when calling contract |
| opponent_multisig | object |   true   | multi-signature parameters                              |

opponent_multisig
| Parameter | Type | Required | Explain |
| :----- | :----: | :---: | :-------------------------- |
| receivers | string[] | true | array of user_id in multi-signature |
| threshold | number | true | minimum number to pass |

### Response

```json
{
  "type": "payment",
  "trace_id": "19f7e906-45b5-4638-891f-5595a0a09495",
  "asset_id": "965e5c6e-434c-3fa9-b780-c50f43cd955c",
  "amount": "0.00000001",
  "threshold": 3,
  "receivers": [
    "a15e0b6d-76ed-4443-b83f-ade9eca2681a",
    "b9126674-b07d-49b6-bf4f-48d965b2242b",
    "15141fe4-1cfd-40f8-9819-71e453054639",
    "3e72ca0c-1bab-49ad-aa0a-4d8471d375e7"
  ],
  "memo": "AAGGxYdl7IE8pKNbh181oK19AAAAAAA5AJbciA7QNc_dLzNIdDebtqEorKeIgbrBTwAAAAAAAAAAAAAAAJqe4TJWQW9BoqSZwNQXlmNAcmmo",
  "created_at": "2022-05-11T09:44:33.544707789Z",
  "status": "pending",
  "code_id": "bffb3218-87de-4e85-a7ad-d672194259ad"
}
```

> It is `code_id` that developers should pay attention to, 
and let user pay through `mixin://codes/:code_id` in Mixin Messenger to call contract functions.

### Examples

1. Contract Call without asset

Counter Contract

```javascript
import { v4 as uuid } from 'uuid';
import { 
  MVMApi, 
  MVMApiURI, 
  getExtra, 
  MVMMainnet 
} from '@mixin.dev/mixin-node-sdk';

const contract = {
  address: '0x4f31E2eAF25DCDD46651AcE019B61E3E750023E0',
  method: 'addOne'
}
const extra = getExtra([contract]);

const params = {
  asset_id: '965e5c6e-434c-3fa9-b780-c50f43cd955c',
  // default minimum amount
  amount: '0.00000001',
  trace_id: uuid(),
  memo: encodeMemo(extra, MVMMainnet.Registry.PID),
  opponent_multisig: {
    receivers: MVMMainnet.MVMMembers,
    threshold: MVMMainnet.MVMThreshold,  
  },
};

const mvmClient = MVMApi(MVMApiURI);
mvmClient.payments(params).then(res => {
  console.log(`mixin://codes/${res.code_id}`);
});
```

Bind function in Bridge Contract

```javascript
import { v4 as uuid } from 'uuid';
import { 
  MVMApi, 
  MVMApiURI, 
  getExtra, 
  MVMMainnet 
} from '@mixin.dev/mixin-node-sdk';

const contract = {
  address: '0x96dC880Ed035CFdd2F334874379bb6A128aca788',
  method: 'bind',
  types: ['address'],
  values: ['0x9A9EE13256416f41a2a499C0d4179663407269A8']
}
const extra = getExtra([contract]);

const params = {
  asset_id: '965e5c6e-434c-3fa9-b780-c50f43cd955c',
  // default minimum amount
  amount: '0.00000001',
  trace_id: uuid(),
  memo: encodeMemo(extra, MVMMainnet.Registry.PID),
  opponent_multisig: {
    receivers: MVMMainnet.MVMMembers,
    threshold: MVMMainnet.MVMThreshold,
  },
};

const mvmClient = MVMApi(MVMApiURI);
mvmClient.payments(params).then(res => {
  console.log(`mixin://codes/${res.code_id}`);
});
```

2. Contract Calling with asset

Deposit function in Bridge Contract

```javascript
import { v4 as uuid } from 'uuid';
import { 
  MVMApi, 
  MVMApiTURI, 
  getExtra, 
  MVMMainnet 
} from '@mixin.dev/mixin-node-sdk';

const asset_id = "965e5c6e-434c-3fa9-b780-c50f43cd955c";
const amount = "1";

const contract = {
  address: '0x96dC880Ed035CFdd2F334874379bb6A128aca788',
  method: 'deposit',
  types: ["address", "uint256"],
  values: ["0x001fB10b1bFede8505AB138c2Bb2E239CB3b50dC", "100000000"]
}
const extra = getExtra([contract]);

const params = {
  asset_id,
  amount,
  trace_id: uuid(),
  memo: encodeMemo(extra, MVMMainnet.Registry.PID),
  opponent_multisig: {
    receivers: MVMMainnet.MVMMembers,
    threshold: MVMMainnet.MVMThreshold,
  }
};

const mvmClient = MVMApi(MVMApiURI);
mvmClient.payments(params).then(res => {
  console.log(`mixin://codes/${res.code_id}`);
});
```

[//]: # (3. Complicated Contract Calling)

[//]: # ()
[//]: # (Swap function in Uniswap Contract)

[//]: # ()
[//]: # (```javascript)

[//]: # (import { v4 as uuid } from 'uuid';)

[//]: # (import { )

[//]: # (  MVMApi, )

[//]: # (  MVMApiURI, )

[//]: # (  getExtra, )

[//]: # (  MVMMainnet )

[//]: # (} from '@mixin.dev/mixin-node-sdk';)

[//]: # ()
[//]: # (const asset_id = "965e5c6e-434c-3fa9-b780-c50f43cd955c";)

[//]: # (const amount = "1";)

[//]: # ()
[//]: # (const contract = {)

[//]: # (  address: '0xe4aeAc26BCd161aFAEea468AC22F45FE5a35737F',)

[//]: # (  method: 'swapExactTokensForTokens',)

[//]: # (  types: ["uint256", "uint256", "address[]", "address", "uint256"],)

[//]: # (  values: [)

[//]: # (    100000000,)

[//]: # (    12400948731547,)

[//]: # (    [)

[//]: # (      "0x001fB10b1bFede8505AB138c2Bb2E239CB3b50dC",)

[//]: # (      "0x71c1C2D82b39C0e952751c9BEA39c28c70c47Ff4")

[//]: # (    ],)

[//]: # (    "0xa192D5856A9a7c07731bc13559Da7489C7829C74",)

[//]: # (    1652262893)

[//]: # (  ])

[//]: # (})

[//]: # (const extra = getExtra&#40;[contract]&#41;;)

[//]: # ()
[//]: # (const params = {)

[//]: # (  asset_id,)

[//]: # (  amount,)

[//]: # (  trace_id: uuid&#40;&#41;,)

[//]: # (  memo: encodeMemo&#40;extra, MVMMainnet.Registry.PID&#41;,)

[//]: # (  opponent_multisig: {)

[//]: # (    receivers: MVMMainnet.MVMMembers,)

[//]: # (    threshold: MVMMainnet.MVMThreshold,)

[//]: # (  },)

[//]: # (};)

[//]: # ()
[//]: # (const mvmClient = MVMApi&#40;MVMApiURI&#41;;)

[//]: # (mvmClient.payments&#40;params&#41;.then&#40;res => {)

[//]: # (  console.log&#40;`mixin://codes/${res.code_id}`&#41;;)

[//]: # (}&#41;;)

[//]: # (```)

[//]: # ()
[//]: # (4. 需要非 mixin 映射资产的调用.)

[//]: # ()
[//]: # (uniswap 的移除流动性方法调用)

[//]: # ()
[//]: # (```javascript)

[//]: # (import { v4 as uuid } from 'uuid';)

[//]: # (import { )

[//]: # (  MVMApi, )

[//]: # (  MVMApiURI, )

[//]: # (  getExtra, )

[//]: # (  MVMMainnet )

[//]: # (} from '@mixin.dev/mixin-node-sdk';)

[//]: # ()
[//]: # (// 资产地址)

[//]: # (const asset_id = "965e5c6e-434c-3fa9-b780-c50f43cd955c";)

[//]: # (// 转账金额)

[//]: # (const amount = "1";)

[//]: # ()
[//]: # (const contract = {)

[//]: # (  address: '0x774A9E576f14d81d7fB439efB1Eb14973a7144Fb',)

[//]: # (  method: 'removeLiquidity',)

[//]: # (  types: [)

[//]: # (    "address",)

[//]: # (    "address",)

[//]: # (    "address",)

[//]: # (    "address",)

[//]: # (    "uint256",)

[//]: # (    "uint256",)

[//]: # (    "uint256")

[//]: # (  ],)

[//]: # (  values: [)

[//]: # (    "0x5EFDe32C3857fe54b152D3ffa7DCE31e28b83aC6",)

[//]: # (    "0x001fB10b1bFede8505AB138c2Bb2E239CB3b50dC",)

[//]: # (    "0x71c1C2D82b39C0e952751c9BEA39c28c70c47Ff4",)

[//]: # (    "0xa192D5856A9a7c07731bc13559Da7489C7829C74",)

[//]: # (    44,)

[//]: # (    0,)

[//]: # (    0)

[//]: # (  ])

[//]: # (};)

[//]: # (const extra = getExtra&#40;[contract]&#41;;)

[//]: # ()
[//]: # (// step 2: 发送请求)

[//]: # (const params = {)

[//]: # (  // 转账币种)

[//]: # (  asset_id,)

[//]: # (  // 转账金额)

[//]: # (  amount,)

[//]: # (  trace_id: uuid&#40;&#41;,)

[//]: # (  memo: encodeMemo&#40;extra, MVMMainnet.Registry.PID&#41;,)

[//]: # (  opponent_multisig: {)

[//]: # (    receivers: MVMMainnet.MVMMembers,)

[//]: # (    threshold: MVMMainnet.MVMThreshold,)

[//]: # (  })

[//]: # (};)

[//]: # ()
[//]: # (const mvmClient = MVMApi&#40;MVMApiURI&#41;;)

[//]: # (mvmClient.payments&#40;params&#41;.then&#40;res => {)

[//]: # (  console.log&#40;`mixin://codes/${res.code_id}`&#41;;)

[//]: # (}&#41;;)

[//]: # (```)
